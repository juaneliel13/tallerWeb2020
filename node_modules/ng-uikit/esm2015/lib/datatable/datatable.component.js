/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { DatatableService } from './service/datatable.service';
export class DatatableComponent {
    /**
     * @param {?} _dts
     */
    constructor(_dts) {
        this._dts = _dts;
        this.pageChange = new EventEmitter();
        this.sorted = new EventEmitter();
        this.size = 6;
        this.search = {};
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.page = this._dts.getPageData(this.rows, this.size, 1);
        console.log(this.page);
        this.resultCount = this.rows.length;
    }
    /**
     * @param {?} col
     * @return {?}
     */
    getColumnClass(col) {
        /** @type {?} */
        let className = ' ui-dt-cell ';
        if (col.className) {
            className += col.className + ' ';
        }
        if (col.sortable) {
            className += ' sortable';
        }
        return className;
    }
    /**
     * @param {?} e
     * @return {?}
     */
    onPageChange(e) {
        this.page = this._dts.getPageData(this.rows, this.size, e.pageNum);
    }
    /**
     * @param {?} item
     * @return {?}
     */
    sort(item) {
        this.page.rows.sort(this.dynamicSort(item.field));
    }
    /**
     * @param {?} property
     * @return {?}
     */
    dynamicSort(property) {
        /** @type {?} */
        var sortOrder = 1;
        if (property[0] === '-') {
            sortOrder = -1;
            property = property.substr(1);
        }
        return function (a, b) {
            if (sortOrder === -1) {
                return b[property].toString().localeCompare(a[property]);
            }
            else {
                return a[property].toString().localeCompare(b[property]);
            }
        };
    }
    /**
     * @param {?} event
     * @param {?} field
     * @param {?} val
     * @return {?}
     */
    filter(event, field, val) {
        if (val.toString().length) {
            if (event.keyCode === 13 || event.which === 13) {
                this.search = {};
                this.search[field] = val;
                console.log(field, this.search, this.rows);
                /** @type {?} */
                const rows = [];
                this.rows.forEach((item) => {
                    if (item[field].toString().toLowerCase().indexOf(val.toString().toLowerCase()) !== -1) {
                        rows.push(item);
                    }
                });
                this.resultCount = rows.length;
                this.page = this._dts.getPageData(rows, this.size, 1);
            }
        }
        else {
            this.resultCount = this.rows.length;
            this.page = this._dts.getPageData(this.rows, this.size, 1);
        }
    }
}
DatatableComponent.decorators = [
    { type: Component, args: [{
                selector: 'ui-datatable',
                template: `<div class="ui-dt-table">
  <div class="ui-dt-thead row">
    <div *ngFor="let col of columns" [ngClass]="getColumnClass(col)"  >
      {{col.label}}
      <i class="fas fa-sort-amount-up" (click)="sort(col)"></i>
    </div>
  </div>
  <div class="ui-dt-thead row">
    <div *ngFor="let col of columns" [ngClass]="getColumnClass(col)"  >
        <input type="text" class="form-control form-control-sm"
               [name]="col.field"
               [ngModel]="search[col.field]"
               (keyup)="filter($event, col.field, $event.target.value)"
        >
    </div>
  </div>
  <div class="ui-dt-tbody">
    <div *ngFor="let row of page.rows;let i=index;" class="row ui-dt-row">
      <div [attr.class]="col.className +' ui-dt-cell'" *ngFor="let col of columns;let k=index;">
         {{row[col.field]}}
      </div>
    </div>
  </div>
</div>
<ui-pagination
  [size]="size"
  [totalCount]="resultCount"
  (pageChange)="onPageChange($event)">
</ui-pagination>

`,
                styles: [`.ui-dt-thead{border-bottom:1px solid #999}.ui-dt-thead .ui-dt-cell{font-weight:500}.ui-dt-row{border-bottom:1px solid #999}.ui-dt-cell{-ms-word-break:break-word;word-break:break-word;border-left:1px solid #ddd;padding:5px}.ui-dt-row .ui-dt-cell:last-child{border-right:1px solid #ddd}`]
            },] },
];
DatatableComponent.ctorParameters = () => [
    { type: DatatableService }
];
DatatableComponent.propDecorators = {
    rows: [{ type: Input }],
    columns: [{ type: Input }],
    pageChange: [{ type: Output }],
    sorted: [{ type: Output }],
    size: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    DatatableComponent.prototype.rows;
    /** @type {?} */
    DatatableComponent.prototype.columns;
    /** @type {?} */
    DatatableComponent.prototype.pageChange;
    /** @type {?} */
    DatatableComponent.prototype.sorted;
    /** @type {?} */
    DatatableComponent.prototype.size;
    /** @type {?} */
    DatatableComponent.prototype.page;
    /** @type {?} */
    DatatableComponent.prototype.search;
    /** @type {?} */
    DatatableComponent.prototype.resultCount;
    /**
     * @type {?}
     * @private
     */
    DatatableComponent.prototype._dts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXRhYmxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXVpa2l0LyIsInNvdXJjZXMiOlsibGliL2RhdGF0YWJsZS9kYXRhdGFibGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRTdFLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDZCQUE2QixDQUFDO0FBcUM3RCxNQUFNOzs7O0lBV0osWUFBb0IsSUFBc0I7UUFBdEIsU0FBSSxHQUFKLElBQUksQ0FBa0I7UUFQaEMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDaEMsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDN0IsU0FBSSxHQUFHLENBQUMsQ0FBQztRQUVsQixXQUFNLEdBQVEsRUFBRSxDQUFDO0lBSWpCLENBQUM7Ozs7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDM0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN0QyxDQUFDOzs7OztJQUVELGNBQWMsQ0FBQyxHQUFXOztZQUNwQixTQUFTLEdBQUcsY0FBYztRQUM5QixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNsQixTQUFTLElBQUksR0FBRyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUM7UUFDbkMsQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FB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QUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ3BDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdELENBQUM7SUFDSCxDQUFDOzs7WUE3R0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxjQUFjO2dCQUN4QixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQThCWDtnQkFDQyxNQUFNLEVBQUUsQ0FBQyw4UkFBOFIsQ0FBQzthQUN6Uzs7O1lBcENPLGdCQUFnQjs7O21CQXVDckIsS0FBSztzQkFDTCxLQUFLO3lCQUNMLE1BQU07cUJBQ04sTUFBTTttQkFDTixLQUFLOzs7O0lBSk4sa0NBQWM7O0lBQ2QscUNBQXlCOztJQUN6Qix3Q0FBMEM7O0lBQzFDLG9DQUFzQzs7SUFDdEMsa0NBQWtCOztJQUNsQixrQ0FBVzs7SUFDWCxvQ0FBaUI7O0lBQ2pCLHlDQUFvQjs7Ozs7SUFFUixrQ0FBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0NvbHVtbiwgUGFnZSwgUGFnaW5nfSBmcm9tICcuL2RhdGF0YWJsZS5pbnRlcmZhY2UnO1xyXG5pbXBvcnQge0RhdGF0YWJsZVNlcnZpY2V9IGZyb20gJy4vc2VydmljZS9kYXRhdGFibGUuc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3VpLWRhdGF0YWJsZScsXHJcbiAgdGVtcGxhdGU6IGA8ZGl2IGNsYXNzPVwidWktZHQtdGFibGVcIj5cclxuICA8ZGl2IGNsYXNzPVwidWktZHQtdGhlYWQgcm93XCI+XHJcbiAgICA8ZGl2ICpuZ0Zvcj1cImxldCBjb2wgb2YgY29sdW1uc1wiIFtuZ0NsYXNzXT1cImdldENvbHVtbkNsYXNzKGNvbClcIiAgPlxyXG4gICAgICB7e2NvbC5sYWJlbH19XHJcbiAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXNvcnQtYW1vdW50LXVwXCIgKGNsaWNrKT1cInNvcnQoY29sKVwiPjwvaT5cclxuICAgIDwvZGl2PlxyXG4gIDwvZGl2PlxyXG4gIDxkaXYgY2xhc3M9XCJ1aS1kdC10aGVhZCByb3dcIj5cclxuICAgIDxkaXYgKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zXCIgW25nQ2xhc3NdPVwiZ2V0Q29sdW1uQ2xhc3MoY29sKVwiICA+XHJcbiAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2wgZm9ybS1jb250cm9sLXNtXCJcclxuICAgICAgICAgICAgICAgW25hbWVdPVwiY29sLmZpZWxkXCJcclxuICAgICAgICAgICAgICAgW25nTW9kZWxdPVwic2VhcmNoW2NvbC5maWVsZF1cIlxyXG4gICAgICAgICAgICAgICAoa2V5dXApPVwiZmlsdGVyKCRldmVudCwgY29sLmZpZWxkLCAkZXZlbnQudGFyZ2V0LnZhbHVlKVwiXHJcbiAgICAgICAgPlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+XHJcbiAgPGRpdiBjbGFzcz1cInVpLWR0LXRib2R5XCI+XHJcbiAgICA8ZGl2ICpuZ0Zvcj1cImxldCByb3cgb2YgcGFnZS5yb3dzO2xldCBpPWluZGV4O1wiIGNsYXNzPVwicm93IHVpLWR0LXJvd1wiPlxyXG4gICAgICA8ZGl2IFthdHRyLmNsYXNzXT1cImNvbC5jbGFzc05hbWUgKycgdWktZHQtY2VsbCdcIiAqbmdGb3I9XCJsZXQgY29sIG9mIGNvbHVtbnM7bGV0IGs9aW5kZXg7XCI+XHJcbiAgICAgICAgIHt7cm93W2NvbC5maWVsZF19fVxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gIDwvZGl2PlxyXG48L2Rpdj5cclxuPHVpLXBhZ2luYXRpb25cclxuICBbc2l6ZV09XCJzaXplXCJcclxuICBbdG90YWxDb3VudF09XCJyZXN1bHRDb3VudFwiXHJcbiAgKHBhZ2VDaGFuZ2UpPVwib25QYWdlQ2hhbmdlKCRldmVudClcIj5cclxuPC91aS1wYWdpbmF0aW9uPlxyXG5cclxuYCxcclxuICBzdHlsZXM6IFtgLnVpLWR0LXRoZWFke2JvcmRlci1ib3R0b206MXB4IHNvbGlkICM5OTl9LnVpLWR0LXRoZWFkIC51aS1kdC1jZWxse2ZvbnQtd2VpZ2h0OjUwMH0udWktZHQtcm93e2JvcmRlci1ib3R0b206MXB4IHNvbGlkICM5OTl9LnVpLWR0LWNlbGx7LW1zLXdvcmQtYnJlYWs6YnJlYWstd29yZDt3b3JkLWJyZWFrOmJyZWFrLXdvcmQ7Ym9yZGVyLWxlZnQ6MXB4IHNvbGlkICNkZGQ7cGFkZGluZzo1cHh9LnVpLWR0LXJvdyAudWktZHQtY2VsbDpsYXN0LWNoaWxke2JvcmRlci1yaWdodDoxcHggc29saWQgI2RkZH1gXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0YXRhYmxlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuXHJcbiAgQElucHV0KCkgcm93cztcclxuICBASW5wdXQoKSBjb2x1bW5zOiBDb2x1bW47XHJcbiAgQE91dHB1dCgpIHBhZ2VDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHNvcnRlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBASW5wdXQoKSBzaXplID0gNjtcclxuICBwYWdlOiBQYWdlO1xyXG4gIHNlYXJjaDogYW55ID0ge307XHJcbiAgcmVzdWx0Q291bnQ6IG51bWJlcjtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfZHRzOiBEYXRhdGFibGVTZXJ2aWNlKSB7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMucGFnZSA9IHRoaXMuX2R0cy5nZXRQYWdlRGF0YSh0aGlzLnJvd3MsIHRoaXMuc2l6ZSwgMSk7XHJcbiAgICBjb25zb2xlLmxvZyh0aGlzLnBhZ2UpO1xyXG4gICAgdGhpcy5yZXN1bHRDb3VudCA9IHRoaXMucm93cy5sZW5ndGg7XHJcbiAgfVxyXG5cclxuICBnZXRDb2x1bW5DbGFzcyhjb2w6IENvbHVtbikge1xyXG4gICAgbGV0IGNsYXNzTmFtZSA9ICcgdWktZHQtY2VsbCAnO1xyXG4gICAgaWYgKGNvbC5jbGFzc05hbWUpIHtcclxuICAgICAgY2xhc3NOYW1lICs9IGNvbC5jbGFzc05hbWUgKyAnICc7XHJcbiAgICB9XHJcbiAgICBpZiAoY29sLnNvcnRhYmxlKSB7XHJcbiAgICAgIGNsYXNzTmFtZSArPSAnIHNvcnRhYmxlJztcclxuICAgIH1cclxuICAgIHJldHVybiBjbGFzc05hbWU7XHJcbiAgfVxyXG5cclxuXHJcbiAgb25QYWdlQ2hhbmdlKGU6IFBhZ2luZykge1xyXG4gICAgdGhpcy5wYWdlID0gdGhpcy5fZHRzLmdldFBhZ2VEYXRhKHRoaXMucm93cywgdGhpcy5zaXplLCBlLnBhZ2VOdW0pO1xyXG4gIH1cclxuXHJcbiAgc29ydChpdGVtKSB7XHJcbiAgICB0aGlzLnBhZ2Uucm93cy5zb3J0KHRoaXMuZHluYW1pY1NvcnQoaXRlbS5maWVsZCkpO1xyXG4gIH1cclxuXHJcbiAgZHluYW1pY1NvcnQocHJvcGVydHkpIHtcclxuICAgIHZhciBzb3J0T3JkZXIgPSAxO1xyXG4gICAgaWYgKHByb3BlcnR5WzBdID09PSAnLScpIHtcclxuICAgICAgc29ydE9yZGVyID0gLTE7XHJcbiAgICAgIHByb3BlcnR5ID0gcHJvcGVydHkuc3Vic3RyKDEpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgIGlmIChzb3J0T3JkZXIgPT09IC0xKSB7XHJcbiAgICAgICAgcmV0dXJuIGJbcHJvcGVydHldLnRvU3RyaW5nKCkubG9jYWxlQ29tcGFyZShhW3Byb3BlcnR5XSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGFbcHJvcGVydHldLnRvU3RyaW5nKCkubG9jYWxlQ29tcGFyZShiW3Byb3BlcnR5XSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBmaWx0ZXIoZXZlbnQsIGZpZWxkLCB2YWwpIHtcclxuICAgIGlmICh2YWwudG9TdHJpbmcoKS5sZW5ndGgpIHtcclxuICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzIHx8IGV2ZW50LndoaWNoID09PSAxMykge1xyXG4gICAgICAgIHRoaXMuc2VhcmNoID0ge307XHJcbiAgICAgICAgdGhpcy5zZWFyY2hbZmllbGRdID0gdmFsO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGZpZWxkLCB0aGlzLnNlYXJjaCwgdGhpcy5yb3dzKTtcclxuICAgICAgICBjb25zdCByb3dzID0gW107XHJcbiAgICAgICAgdGhpcy5yb3dzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgIGlmIChpdGVtW2ZpZWxkXS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgcm93cy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMucmVzdWx0Q291bnQgPSByb3dzLmxlbmd0aDtcclxuICAgICAgICB0aGlzLnBhZ2UgPSB0aGlzLl9kdHMuZ2V0UGFnZURhdGEocm93cywgdGhpcy5zaXplLCAxKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5yZXN1bHRDb3VudCA9IHRoaXMucm93cy5sZW5ndGg7XHJcbiAgICAgIHRoaXMucGFnZSA9IHRoaXMuX2R0cy5nZXRQYWdlRGF0YSh0aGlzLnJvd3MsIHRoaXMuc2l6ZSwgMSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=