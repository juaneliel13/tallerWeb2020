/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { DatatableService } from './service/datatable.service';
var DatatableComponent = /** @class */ (function () {
    function DatatableComponent(_dts) {
        this._dts = _dts;
        this.pageChange = new EventEmitter();
        this.sorted = new EventEmitter();
        this.size = 6;
        this.search = {};
    }
    /**
     * @return {?}
     */
    DatatableComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.page = this._dts.getPageData(this.rows, this.size, 1);
        console.log(this.page);
        this.resultCount = this.rows.length;
    };
    /**
     * @param {?} col
     * @return {?}
     */
    DatatableComponent.prototype.getColumnClass = /**
     * @param {?} col
     * @return {?}
     */
    function (col) {
        /** @type {?} */
        var className = ' ui-dt-cell ';
        if (col.className) {
            className += col.className + ' ';
        }
        if (col.sortable) {
            className += ' sortable';
        }
        return className;
    };
    /**
     * @param {?} e
     * @return {?}
     */
    DatatableComponent.prototype.onPageChange = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this.page = this._dts.getPageData(this.rows, this.size, e.pageNum);
    };
    /**
     * @param {?} item
     * @return {?}
     */
    DatatableComponent.prototype.sort = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.page.rows.sort(this.dynamicSort(item.field));
    };
    /**
     * @param {?} property
     * @return {?}
     */
    DatatableComponent.prototype.dynamicSort = /**
     * @param {?} property
     * @return {?}
     */
    function (property) {
        /** @type {?} */
        var sortOrder = 1;
        if (property[0] === '-') {
            sortOrder = -1;
            property = property.substr(1);
        }
        return function (a, b) {
            if (sortOrder === -1) {
                return b[property].toString().localeCompare(a[property]);
            }
            else {
                return a[property].toString().localeCompare(b[property]);
            }
        };
    };
    /**
     * @param {?} event
     * @param {?} field
     * @param {?} val
     * @return {?}
     */
    DatatableComponent.prototype.filter = /**
     * @param {?} event
     * @param {?} field
     * @param {?} val
     * @return {?}
     */
    function (event, field, val) {
        if (val.toString().length) {
            if (event.keyCode === 13 || event.which === 13) {
                this.search = {};
                this.search[field] = val;
                console.log(field, this.search, this.rows);
                /** @type {?} */
                var rows_1 = [];
                this.rows.forEach(function (item) {
                    if (item[field].toString().toLowerCase().indexOf(val.toString().toLowerCase()) !== -1) {
                        rows_1.push(item);
                    }
                });
                this.resultCount = rows_1.length;
                this.page = this._dts.getPageData(rows_1, this.size, 1);
            }
        }
        else {
            this.resultCount = this.rows.length;
            this.page = this._dts.getPageData(this.rows, this.size, 1);
        }
    };
    DatatableComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ui-datatable',
                    template: "<div class=\"ui-dt-table\">\n  <div class=\"ui-dt-thead row\">\n    <div *ngFor=\"let col of columns\" [ngClass]=\"getColumnClass(col)\"  >\n      {{col.label}}\n      <i class=\"fas fa-sort-amount-up\" (click)=\"sort(col)\"></i>\n    </div>\n  </div>\n  <div class=\"ui-dt-thead row\">\n    <div *ngFor=\"let col of columns\" [ngClass]=\"getColumnClass(col)\"  >\n        <input type=\"text\" class=\"form-control form-control-sm\"\n               [name]=\"col.field\"\n               [ngModel]=\"search[col.field]\"\n               (keyup)=\"filter($event, col.field, $event.target.value)\"\n        >\n    </div>\n  </div>\n  <div class=\"ui-dt-tbody\">\n    <div *ngFor=\"let row of page.rows;let i=index;\" class=\"row ui-dt-row\">\n      <div [attr.class]=\"col.className +' ui-dt-cell'\" *ngFor=\"let col of columns;let k=index;\">\n         {{row[col.field]}}\n      </div>\n    </div>\n  </div>\n</div>\n<ui-pagination\n  [size]=\"size\"\n  [totalCount]=\"resultCount\"\n  (pageChange)=\"onPageChange($event)\">\n</ui-pagination>\n\n",
                    styles: [".ui-dt-thead{border-bottom:1px solid #999}.ui-dt-thead .ui-dt-cell{font-weight:500}.ui-dt-row{border-bottom:1px solid #999}.ui-dt-cell{-ms-word-break:break-word;word-break:break-word;border-left:1px solid #ddd;padding:5px}.ui-dt-row .ui-dt-cell:last-child{border-right:1px solid #ddd}"]
                },] },
    ];
    DatatableComponent.ctorParameters = function () { return [
        { type: DatatableService }
    ]; };
    DatatableComponent.propDecorators = {
        rows: [{ type: Input }],
        columns: [{ type: Input }],
        pageChange: [{ type: Output }],
        sorted: [{ type: Output }],
        size: [{ type: Input }]
    };
    return DatatableComponent;
}());
export { DatatableComponent };
if (false) {
    /** @type {?} */
    DatatableComponent.prototype.rows;
    /** @type {?} */
    DatatableComponent.prototype.columns;
    /** @type {?} */
    DatatableComponent.prototype.pageChange;
    /** @type {?} */
    DatatableComponent.prototype.sorted;
    /** @type {?} */
    DatatableComponent.prototype.size;
    /** @type {?} */
    DatatableComponent.prototype.page;
    /** @type {?} */
    DatatableComponent.prototype.search;
    /** @type {?} */
    DatatableComponent.prototype.resultCount;
    /**
     * @type {?}
     * @private
     */
    DatatableComponent.prototype._dts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXRhYmxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXVpa2l0LyIsInNvdXJjZXMiOlsibGliL2RhdGF0YWJsZS9kYXRhdGFibGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRTdFLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDZCQUE2QixDQUFDO0FBRTdEO0lBOENFLDRCQUFvQixJQUFzQjtRQUF0QixTQUFJLEdBQUosSUFBSSxDQUFrQjtRQVBoQyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNoQyxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUM3QixTQUFJLEdBQUcsQ0FBQyxDQUFDO1FBRWxCLFdBQU0sR0FBUSxFQUFFLENBQUM7SUFJakIsQ0FBQzs7OztJQUVELHFDQUFROzs7SUFBUjtRQUNFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDdEMsQ0FBQzs7Ozs7SUFFRCwyQ0FBYzs7OztJQUFkLFVBQWUsR0FBVzs7WUFDcEIsU0FBUyxHQUFHLGNBQWM7UUFDOUIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDbEIsU0FBUyxJQUFJLEdBQUcsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDO1FBQ25DLENBQUM7UUFDRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFB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QztRQUNILENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDcEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDN0QsQ0FBQztJQUNILENBQUM7O2dCQTdHRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGNBQWM7b0JBQ3hCLFFBQVEsRUFBRSxvaENBOEJYO29CQUNDLE1BQU0sRUFBRSxDQUFDLDhSQUE4UixDQUFDO2lCQUN6Uzs7O2dCQXBDTyxnQkFBZ0I7Ozt1QkF1Q3JCLEtBQUs7MEJBQ0wsS0FBSzs2QkFDTCxNQUFNO3lCQUNOLE1BQU07dUJBQ04sS0FBSzs7SUFzRVIseUJBQUM7Q0FBQSxBQS9HRCxJQStHQztTQTVFWSxrQkFBa0I7OztJQUU3QixrQ0FBYzs7SUFDZCxxQ0FBeUI7O0lBQ3pCLHdDQUEwQzs7SUFDMUMsb0NBQXNDOztJQUN0QyxrQ0FBa0I7O0lBQ2xCLGtDQUFXOztJQUNYLG9DQUFpQjs7SUFDakIseUNBQW9COzs7OztJQUVSLGtDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7Q29sdW1uLCBQYWdlLCBQYWdpbmd9IGZyb20gJy4vZGF0YXRhYmxlLmludGVyZmFjZSc7XHJcbmltcG9ydCB7RGF0YXRhYmxlU2VydmljZX0gZnJvbSAnLi9zZXJ2aWNlL2RhdGF0YWJsZS5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAndWktZGF0YXRhYmxlJyxcclxuICB0ZW1wbGF0ZTogYDxkaXYgY2xhc3M9XCJ1aS1kdC10YWJsZVwiPlxyXG4gIDxkaXYgY2xhc3M9XCJ1aS1kdC10aGVhZCByb3dcIj5cclxuICAgIDxkaXYgKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zXCIgW25nQ2xhc3NdPVwiZ2V0Q29sdW1uQ2xhc3MoY29sKVwiICA+XHJcbiAgICAgIHt7Y29sLmxhYmVsfX1cclxuICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtc29ydC1hbW91bnQtdXBcIiAoY2xpY2spPVwic29ydChjb2wpXCI+PC9pPlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+XHJcbiAgPGRpdiBjbGFzcz1cInVpLWR0LXRoZWFkIHJvd1wiPlxyXG4gICAgPGRpdiAqbmdGb3I9XCJsZXQgY29sIG9mIGNvbHVtbnNcIiBbbmdDbGFzc109XCJnZXRDb2x1bW5DbGFzcyhjb2wpXCIgID5cclxuICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbCBmb3JtLWNvbnRyb2wtc21cIlxyXG4gICAgICAgICAgICAgICBbbmFtZV09XCJjb2wuZmllbGRcIlxyXG4gICAgICAgICAgICAgICBbbmdNb2RlbF09XCJzZWFyY2hbY29sLmZpZWxkXVwiXHJcbiAgICAgICAgICAgICAgIChrZXl1cCk9XCJmaWx0ZXIoJGV2ZW50LCBjb2wuZmllbGQsICRldmVudC50YXJnZXQudmFsdWUpXCJcclxuICAgICAgICA+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Rpdj5cclxuICA8ZGl2IGNsYXNzPVwidWktZHQtdGJvZHlcIj5cclxuICAgIDxkaXYgKm5nRm9yPVwibGV0IHJvdyBvZiBwYWdlLnJvd3M7bGV0IGk9aW5kZXg7XCIgY2xhc3M9XCJyb3cgdWktZHQtcm93XCI+XHJcbiAgICAgIDxkaXYgW2F0dHIuY2xhc3NdPVwiY29sLmNsYXNzTmFtZSArJyB1aS1kdC1jZWxsJ1wiICpuZ0Zvcj1cImxldCBjb2wgb2YgY29sdW1ucztsZXQgaz1pbmRleDtcIj5cclxuICAgICAgICAge3tyb3dbY29sLmZpZWxkXX19XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+XHJcbjwvZGl2PlxyXG48dWktcGFnaW5hdGlvblxyXG4gIFtzaXplXT1cInNpemVcIlxyXG4gIFt0b3RhbENvdW50XT1cInJlc3VsdENvdW50XCJcclxuICAocGFnZUNoYW5nZSk9XCJvblBhZ2VDaGFuZ2UoJGV2ZW50KVwiPlxyXG48L3VpLXBhZ2luYXRpb24+XHJcblxyXG5gLFxyXG4gIHN0eWxlczogW2AudWktZHQtdGhlYWR7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgIzk5OX0udWktZHQtdGhlYWQgLnVpLWR0LWNlbGx7Zm9udC13ZWlnaHQ6NTAwfS51aS1kdC1yb3d7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgIzk5OX0udWktZHQtY2VsbHstbXMtd29yZC1icmVhazpicmVhay13b3JkO3dvcmQtYnJlYWs6YnJlYWstd29yZDtib3JkZXItbGVmdDoxcHggc29saWQgI2RkZDtwYWRkaW5nOjVweH0udWktZHQtcm93IC51aS1kdC1jZWxsOmxhc3QtY2hpbGR7Ym9yZGVyLXJpZ2h0OjFweCBzb2xpZCAjZGRkfWBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXRhdGFibGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICBASW5wdXQoKSByb3dzO1xyXG4gIEBJbnB1dCgpIGNvbHVtbnM6IENvbHVtbjtcclxuICBAT3V0cHV0KCkgcGFnZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgc29ydGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBJbnB1dCgpIHNpemUgPSA2O1xyXG4gIHBhZ2U6IFBhZ2U7XHJcbiAgc2VhcmNoOiBhbnkgPSB7fTtcclxuICByZXN1bHRDb3VudDogbnVtYmVyO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9kdHM6IERhdGF0YWJsZVNlcnZpY2UpIHtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5wYWdlID0gdGhpcy5fZHRzLmdldFBhZ2VEYXRhKHRoaXMucm93cywgdGhpcy5zaXplLCAxKTtcclxuICAgIGNvbnNvbGUubG9nKHRoaXMucGFnZSk7XHJcbiAgICB0aGlzLnJlc3VsdENvdW50ID0gdGhpcy5yb3dzLmxlbmd0aDtcclxuICB9XHJcblxyXG4gIGdldENvbHVtbkNsYXNzKGNvbDogQ29sdW1uKSB7XHJcbiAgICBsZXQgY2xhc3NOYW1lID0gJyB1aS1kdC1jZWxsICc7XHJcbiAgICBpZiAoY29sLmNsYXNzTmFtZSkge1xyXG4gICAgICBjbGFzc05hbWUgKz0gY29sLmNsYXNzTmFtZSArICcgJztcclxuICAgIH1cclxuICAgIGlmIChjb2wuc29ydGFibGUpIHtcclxuICAgICAgY2xhc3NOYW1lICs9ICcgc29ydGFibGUnO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNsYXNzTmFtZTtcclxuICB9XHJcblxyXG5cclxuICBvblBhZ2VDaGFuZ2UoZTogUGFnaW5nKSB7XHJcbiAgICB0aGlzLnBhZ2UgPSB0aGlzLl9kdHMuZ2V0UGFnZURhdGEodGhpcy5yb3dzLCB0aGlzLnNpemUsIGUucGFnZU51bSk7XHJcbiAgfVxyXG5cclxuICBzb3J0KGl0ZW0pIHtcclxuICAgIHRoaXMucGFnZS5yb3dzLnNvcnQodGhpcy5keW5hbWljU29ydChpdGVtLmZpZWxkKSk7XHJcbiAgfVxyXG5cclxuICBkeW5hbWljU29ydChwcm9wZXJ0eSkge1xyXG4gICAgdmFyIHNvcnRPcmRlciA9IDE7XHJcbiAgICBpZiAocHJvcGVydHlbMF0gPT09ICctJykge1xyXG4gICAgICBzb3J0T3JkZXIgPSAtMTtcclxuICAgICAgcHJvcGVydHkgPSBwcm9wZXJ0eS5zdWJzdHIoMSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgaWYgKHNvcnRPcmRlciA9PT0gLTEpIHtcclxuICAgICAgICByZXR1cm4gYltwcm9wZXJ0eV0udG9TdHJpbmcoKS5sb2NhbGVDb21wYXJlKGFbcHJvcGVydHldKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gYVtwcm9wZXJ0eV0udG9TdHJpbmcoKS5sb2NhbGVDb21wYXJlKGJbcHJvcGVydHldKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGZpbHRlcihldmVudCwgZmllbGQsIHZhbCkge1xyXG4gICAgaWYgKHZhbC50b1N0cmluZygpLmxlbmd0aCkge1xyXG4gICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMgfHwgZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgdGhpcy5zZWFyY2ggPSB7fTtcclxuICAgICAgICB0aGlzLnNlYXJjaFtmaWVsZF0gPSB2YWw7XHJcbiAgICAgICAgY29uc29sZS5sb2coZmllbGQsIHRoaXMuc2VhcmNoLCB0aGlzLnJvd3MpO1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSBbXTtcclxuICAgICAgICB0aGlzLnJvd3MuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgaWYgKGl0ZW1bZmllbGRdLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZhbC50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkpICE9PSAtMSkge1xyXG4gICAgICAgICAgICByb3dzLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5yZXN1bHRDb3VudCA9IHJvd3MubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMucGFnZSA9IHRoaXMuX2R0cy5nZXRQYWdlRGF0YShyb3dzLCB0aGlzLnNpemUsIDEpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnJlc3VsdENvdW50ID0gdGhpcy5yb3dzLmxlbmd0aDtcclxuICAgICAgdGhpcy5wYWdlID0gdGhpcy5fZHRzLmdldFBhZ2VEYXRhKHRoaXMucm93cywgdGhpcy5zaXplLCAxKTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==